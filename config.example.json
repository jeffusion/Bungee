{
  "bodyParserLimit": "50mb",
  "routes": [
    {
      "path": "/api/ai",
      "transformer": "anthropic-to-openai",
      "upstreams": [
        {
          "target": "https://api.openai.com",
          "priority": 1,
          "weight": 100
        },
        {
          "target": "https://api.gemini.com",
          "priority": 2,
          "weight": 100,
          "transformer": "anthropic-to-gemini"
        }
      ]
    },
    {
      "path": "/api/simple",
      "upstreams": [
        {
          "target": "http://single-service.example.com",
          "priority": 1,
          "headers": {
            "add": {
              "x-request-id": "{{uuid()}}",
              "x-timestamp": "{{now()}}",
              "x-proxy-version": "1.0"
            }
          },
          "body": {
            "add": {
              "proxy_processed": true,
              "request_time": "{{new Date().toISOString()}}"
            }
          }
        }
      ]
    },
    {
      "path": "/api/load-balanced-with-override",
      "headers": {
        "add": {
          "x-common": "true",
          "x-version": "v1",
          "x-request-host": "{{headers.host}}",
          "x-method": "{{method}}"
        },
        "replace": {
          "user-agent": "{{headers['user-agent'] + ' (via-proxy/1.0)'}}",
          "authorization": "{{headers.authorization ? headers.authorization : 'Bearer default-token'}}"
        },
        "remove": ["x-internal-debug"]
      },
      "body": {
        "replace": {
          "api_version": "{{body.api_version || 'v2'}}",
          "timestamp": "{{now()}}"
        },
        "default": {
          "timeout": 30,
          "client_ip": "{{trim(first(split(headers['x-forwarded-for'], ',')))}}"
        }
      },
      "upstreams": [
        { "target": "http://service-a.example.com", "weight": 80, "priority": 1 },
        {
          "target": "http://service-b-canary.example.com",
          "weight": 20,
          "priority": 1,
          "headers": {
            "add": {
              "x-version": "v2-canary",
              "x-canary-id": "{{uuid()}}"
            },
            "replace": {
              "authorization": "{{parseJWT(last(split(headers.authorization, ' '))).sub ? 'Bearer canary-' + last(split(headers.authorization, ' ')) : 'Bearer canary-default'}}"
            }
          },
          "body": {
            "replace": {
              "environment": "canary",
              "session_id": "{{body.session_id || uuid()}}"
            }
          }
        }
      ]
    },
    {
      "path": "/api/critical",
      "upstreams": [
        { "target": "http://primary-critical-service.com", "priority": 1 },
        { "target": "http://backup-critical-service.com", "weight": 100, "priority": 1 },
        { "target": "http://fallback-critical-service.com", "weight": 50, "priority": 2 }
      ],
      "failover": {
        "enabled": true,
        "retryableStatusCodes": [500, 502, 503, 504]
      },
      "healthCheck": {
        "enabled": true,
        "intervalSeconds": 10
      }
    }
  ]
}
